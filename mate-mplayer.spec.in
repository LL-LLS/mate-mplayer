%bcond_without minimal

Name:           mate-mplayer
Version:        1.0.8
Release:        1%{?dist}
Summary:        An MPlayer GUI, a full-featured binary

License:        GPLv2+
URL:            https://github.com/NiceandGently/mate-mplayer
Source0:        https://github.com/downloads/NiceandGently/mate-mplayer/%{name}-%{version}.tar.gz

BuildRequires:  alsa-lib-devel
BuildRequires:  dbus-glib-devel
BuildRequires:  desktop-file-utils
BuildRequires:  gettext
BuildRequires:  gmtk-devel == %{version}
BuildRequires:  gtk3-devel
BuildRequires:  libcurl-devel
BuildRequires:  libgpod-devel
BuildRequires:  libmusicbrainz3-devel
BuildRequires:  libnotify-devel
BuildRequires:  libXScrnSaver-devel
BuildRequires:  mate-file-manager-devel
BuildRequires:  pulseaudio-libs-devel


Requires:       mate-control-center
Requires:       gvfs-fuse%{?_isa}
Requires:       mencoder%{?_isa}
Requires:       %{name}-common%{?_isa} = %{version}-%{release}

Provides:       %{name}-binary%{?_isa} = %{version}-%{release}

%description
MATE MPlayer is a simple GUI for MPlayer. It is intended to be a nice tight
player and provide a simple and clean interface to MPlayer. MATE MPlayer has
a rich API that is exposed via DBus. Using DBus you can control a single or
multiple instances of MATE MPlayer from a single command.
This package provides a full-featured binary.


%package common
Summary:        An MPlayer GUI, common files

%description common
MATE MPlayer is a simple GUI for MPlayer. It is intended to be a nice tight
player and provide a simple and clean interface to MPlayer. MATE MPlayer has
a rich API that is exposed via DBus. Using DBus you can control a single or
multiple instances of MATE MPlayer from a single command.
This package provides the common files.


%if %{with minimal}
%package minimal
Summary:        An MPlayer GUI, a minimal version
Requires:       %{name}-common%{?_isa} = %{version}-%{release}
Provides:       %{name}-binary%{?_isa} = %{version}-%{release}

%description minimal
MATE MPlayer is a simple GUI for MPlayer. It is intended to be a nice tight
player and provide a simple and clean interface to MPlayer. MATE MPlayer has
a rich API that is exposed via DBus. Using DBus you can control a single or
multiple instances of MATE MPlayer from a single command.
This package provides a version with reduced requirements, targeted at users
who want browser plugin functionality only.
%endif


%package caja
Summary:        An MPlayer GUI, caja extension
Requires:       %{name}%{?_isa} = %{version}-%{release}

%description caja
MATE MPlayer is a simple GUI for MPlayer. It is intended to be a nice tight
player and provide a simple and clean interface to MPlayer. MATE MPlayer has
a rich API that is exposed via DBus. Using DBus you can control a single or
multiple instances of MATE MPlayer from a single command.
This package provides a caja extension, which shows properties of audio and
video files in the properties dialogue.


%prep
%setup -qcT
tar -xzf %{SOURCE0}
mv %{name}-%{version} generic
%if %{with minimal}
tar -xzf %{SOURCE0}
mv %{name}-%{version} minimal
%endif


%build
pushd generic
%configure \
	--with-libnotify \
	--enable-gtk3 \
	--enable-caja \
	--with-dbus \
	--with-alsa \
	--with-pulseaudio \
	--with-libgpod \
	--with-libmusicbrainz3 \
	--with-gio \
    --disable-schemas-compile

make %{?_smp_mflags}
popd

%if %{with minimal}
pushd minimal
%configure --program-suffix=-minimal --without-gio --without-libnotify \
    --without-libgpod --without-libmusicbrainz3 --disable-caja --enable-gtk3 \
	--with-dbus --with-alsa --with-pulseaudio --disable-schemas-compile --without-libgda
make %{?_smp_mflags}
popd
%endif


%install
pushd generic
make install DESTDIR=$RPM_BUILD_ROOT
popd

%if %{with minimal}
pushd minimal
make install DESTDIR=$RPM_BUILD_ROOT
popd
%endif

%find_lang %{name}

#remove intrusive docs
rm -rf $RPM_BUILD_ROOT%{_docdir}/mate-mplayer

#kill the libtool archives
find $RPM_BUILD_ROOT -name *.la -exec rm -f {} \;


%check
desktop-file-validate $RPM_BUILD_ROOT%{_datadir}/applications/mate-mplayer.desktop


%post
update-desktop-database &> /dev/null || :


%postun
update-desktop-database &> /dev/null || :


%postun common
if [ $1 -eq 0 ] ; then
    /usr/bin/touch --no-create %{_datadir}/icons/hicolor &>/dev/null
    /usr/bin/gtk-update-icon-cache %{_datadir}/icons/hicolor &>/dev/null || :
fi
if [ $1 -eq 0 ] ; then
    /usr/bin/glib-compile-schemas %{_datadir}/glib-2.0/schemas &> /dev/null || :
fi


%posttrans common
/usr/bin/gtk-update-icon-cache %{_datadir}/icons/hicolor &>/dev/null || :
/usr/bin/glib-compile-schemas %{_datadir}/glib-2.0/schemas &> /dev/null || :


%files
%{_bindir}/mate-mplayer
%{_datadir}/applications/mate-mplayer.desktop
%{_datadir}/mate-control-center/default-apps/mate-mplayer.xml


%files common -f %{name}.lang
%doc generic/COPYING generic/ChangeLog generic/README generic/DOCS/keyboard_shortcuts.txt generic/DOCS/tech/*
%{_datadir}/glib-2.0/schemas/org.mate.gecko-mediaplayer.preferences.gschema.xml
%{_datadir}/glib-2.0/schemas/org.mate.mate-mplayer.preferences.*
%{_datadir}/icons/hicolor/*/apps/mate-mplayer.*
%{_mandir}/man1/mate-mplayer.1*


%if %{with minimal}
%files minimal
%{_bindir}/mate-mplayer-minimal
%endif


%files caja
%{_libdir}/caja/extensions-2.0/libmate-mplayer-properties-page.so*


%changelog
* Mon May 13 2013 Wolfgang Ulbrich <chat-to-me@raveit.de> - 1.0.8-1
- update to 1.0.8

* Fri Nov 16 2012 Wolfgang Ulbrich <chat-to-me@raveit.de> - 1.0.7-0101
- build against fedora official mate-desktop
- change requires mate-control-center-filesystem to mate-control-center
- remove epoch
- update to 1.0.7
- switch to libnotify as BR
- fix gsettings path
- improve and review spec file
- add desktop-file-validate

* Mon Aug 27 2012 Wolfgang Ulbrich <chat-to-me@raveit.de> - 1.0.6-0100
- build for f18

* Fri Jun 22 2012 Wolfgang Ulbrich <chat-to-me@raveit.de> - 1.0.6-1
- build for the MATE desktop

* Mon Apr 16 2012 Julian Sikorski <belegdol@fedoraproject.org> - 1.0.6-2
- Rebuilt for new libimobiledevice and usbmuxd (RPM Fusion #2280)

